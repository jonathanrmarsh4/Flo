import { Sparkles, ChevronRight } from 'lucide-react';

interface InsightItem {
  id: string;
  title: string;
  insight: string;
  recommendedAction: string;
  category: 'Sleep' | 'Activity' | 'Biomarkers' | 'Recovery' | 'Nutrition';
  targetBiomarker?: string;
  currentValue?: number;
  targetValue?: number;
  unit?: string;
}

interface AIInsightsTileProps {
  isDark: boolean;
  onClick: () => void;
}

// Mock AI-generated insights for the dashboard tile
const aiInsights: InsightItem[] = [
  {
    id: '1',
    title: 'Optimize Vitamin D Levels',
    insight: 'Your Vitamin D levels have been trending below optimal range for the past 6 months, correlating with decreased energy and sleep quality.',
    recommendedAction: 'Increase daily Vitamin D3 supplementation to 4,000 IU and aim for 15-20 minutes of direct sunlight exposure daily.',
    category: 'Biomarkers',
    targetBiomarker: 'Vitamin D',
    currentValue: 28,
    targetValue: 50,
    unit: 'ng/mL'
  },
  {
    id: '2',
    title: 'Improve Sleep Consistency',
    insight: 'Your sleep onset time varies by more than 90 minutes across the week, impacting your HRV recovery and morning glucose levels.',
    recommendedAction: 'Establish a consistent bedtime routine. Aim to sleep between 10:00-10:30 PM every night, including weekends.',
    category: 'Sleep',
    targetBiomarker: 'HRV',
    currentValue: 52,
    targetValue: 68,
    unit: 'ms'
  }
];

// Mini Insight Card for Dashboard
function MiniInsightCard({ insight, isDark, onClick }: { insight: InsightItem; isDark: boolean; onClick: () => void }) {
  const categoryColors = {
    Sleep: 'text-indigo-400',
    Activity: 'text-orange-400',
    Biomarkers: 'text-teal-400',
    Recovery: 'text-green-400',
    Nutrition: 'text-amber-400'
  };

  return (
    <div 
      onClick={onClick}
      className={`p-3 rounded-xl border transition-all cursor-pointer hover:scale-[1.02] ${
        isDark ? 'bg-white/5 border-white/10 hover:bg-white/10' : 'bg-white/80 border-black/10 hover:bg-white'
      }`}
    >
      <div className="flex items-start justify-between mb-2">
        <h4 className={`text-sm font-medium line-clamp-1 flex-1 ${isDark ? 'text-white' : 'text-gray-900'}`}>
          {insight.title}
        </h4>
        <span className={`text-xs ml-2 flex-shrink-0 ${categoryColors[insight.category]}`}>
          {insight.category}
        </span>
      </div>
      <p className={`text-xs line-clamp-2 ${isDark ? 'text-white/60' : 'text-gray-600'}`}>
        {insight.insight}
      </p>
    </div>
  );
}

export function AIInsightsTile({ isDark, onClick }: AIInsightsTileProps) {
  return (
    <div 
      className={`backdrop-blur-xl rounded-3xl border transition-all overflow-hidden ${
        isDark ? 'bg-white/5 border-white/10' : 'bg-white/60 border-black/10'
      }`}
    >
      {/* Header */}
      <div className="p-5 pb-4">
        <div className="flex items-center justify-between mb-1">
          <div className="flex items-center gap-3">
            <div className="p-2.5 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30">
              <Sparkles className="w-5 h-5 text-purple-400" />
            </div>
            <div>
              <h3 className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>
                AI Insights
              </h3>
              <p className={`text-xs ${isDark ? 'text-white/50' : 'text-gray-500'}`}>
                Personalized health recommendations
              </p>
            </div>
          </div>
          {aiInsights.length > 0 && (
            <div className="px-2.5 py-1 rounded-full bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500">
              <span className="text-xs text-white font-medium">{aiInsights.length} new</span>
            </div>
          )}
        </div>
      </div>

      {/* Mini Insight Cards */}
      {aiInsights.length > 0 ? (
        <div className="px-5 pb-3 space-y-2">
          {aiInsights.slice(0, 2).map((insight, index) => (
            <div
              key={insight.id}
              style={{
                animation: `fadeInUp 0.4s ease-out ${index * 0.1}s both`
              }}
            >
              <MiniInsightCard insight={insight} isDark={isDark} onClick={onClick} />
            </div>
          ))}
        </div>
      ) : (
        <div className="px-5 pb-4 text-center">
          <div className="text-4xl mb-2 opacity-20">âœ¨</div>
          <p className={`text-xs ${isDark ? 'text-white/50' : 'text-gray-500'}`}>
            No insights available yet
          </p>
        </div>
      )}

      {/* View All Button */}
      <button
        onClick={onClick}
        className={`w-full px-5 py-3.5 border-t flex items-center justify-between transition-colors ${
          isDark 
            ? 'border-white/10 hover:bg-white/5' 
            : 'border-gray-200 hover:bg-black/5'
        }`}
      >
        <span className={`text-sm ${isDark ? 'text-white/70' : 'text-gray-600'}`}>
          View all insights
        </span>
        <ChevronRight className={`w-4 h-4 ${isDark ? 'text-white/50' : 'text-gray-400'}`} />
      </button>

      <style>{`
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `}</style>
    </div>
  );
}
