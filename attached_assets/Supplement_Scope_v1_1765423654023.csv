Table 1
1. Overview,,,,
"Module: Experiment Configuration Engine Goal: To automatically configure the tracked metrics, baseline duration, and success criteria for an experiment based on the specific supplement identified. User Value: ""Zero-config"" setup. The user scans a bottle, and the app instantly knows that Magnesium requires tracking Deep Sleep, whereas Creatine requires tracking Weight and Active Energy.",,,,
,,,,
API for Supplement information: https://dsld.od.nih.gov/,,,,
2. The Configuration Matrix (10 Common Supplements),,,,
"This table defines the ""Smart Defaults"" your backend will apply. It uses the exact field names from your schema.",,,,
,,,,
Supplement,Protocol Type,Primary Metrics (Success Indicators),Secondary Metrics (Safety/Correlations),Relevant Blood/CGM
1. Magnesium (Glycinate/Citrate),Acute/Daily (Fast acting),"Sleep Quality: deepMinutes, sleepEfficiency, totalMinutesAsleep","Recovery: avgHrv, avgRespiratoryRate",Blood: Serum Magnesium
2. Creatine Monohydrate,Chronic (Requires Loading),"Performance: activeEnergyKcal, leanBodyMassKg (if avail)","Hydration/Mass: weightKg (Expect increase), dietaryWater","Blood: Creatinine, BUN"
3. Ashwagandha,Chronic (2-4 weeks),"Stress Response: hrvMs, avgHrv (Night), restingHrBpm","Sleep: sleepEfficiency, wakeAt (Latency)","Blood: Cortisol, Thyroid Panel"
4. Melatonin,Acute (Immediate),"Onset Latency: (asleepAt - inBedAt), totalMinutesAsleep","Sleep Architecture: remMinutes, deepMinutes",N/A
5. Omega-3 (Fish Oil),Chronic (Long term),"Cardio Health: hrvMs, restingHrBpm","Vitals: systolicMmHg, diastolicMmHg","Blood: Omega-3 Index, HS-CRP"
6. Vitamin D3,Chronic (Very Slow),"Energy/Mood: activeEnergyKcal, sleepEfficiency","Activity: stepsNormalized, flightsClimbed",Blood: 25-OH Vitamin D
7. Caffeine (or Pre-workout),Acute (Event based),"Stimulation: hrvMs (Watch for drops), restingHrBpm (Watch for spikes)","Sleep Negative: sleepEfficiency, deepMinutes",N/A
8. Fiber / Psyllium,Chronic (Daily),Metabolic: bloodGlucoseMgDl (CGM - Look for stability),"Weight: weightKg, waistCircumference","Blood: HbA1c, Lipids"
9. Iron,Chronic (Slow),"Fatigue/Capacity: vo2Max, activeEnergyKcal","Vitals: restingHrBpm, walkingHrBpm","Blood: Ferritin, Hemoglobin"
10. L-Theanine,Acute (Fast),"Relaxation: hrvMs (Acute rise), avgRespiratoryRate",Focus (Subjective): Correlate w/ exerciseMinutes,N/A
11. Probiotics(Lactobacillus/Bifido),"Chronic (Daily, 14+ days)","Gut-Brain Axis: hrvMs(Inflammation proxy), sleepEfficiency","Digestion: dietaryWater(Hydration), Subjective ""Bloating"" Score",Blood: HS-CRP (Inflammation)
12. Turmeric / Curcumin,Chronic(Daily),"Recovery/Pain:activeEnergyKcal (Pain often limits movement), hrvMs","Sleep: restlessness (Pain disrupts sleep), deepMinutes","Blood: ESR, CRP"
13. CoQ10(Ubiquinol),Chronic (Slow build),"Cardio Capacity: vo2Max, cardioRecovery (HR drop post-workout)","Energy:appleExerciseTime, flightsClimbed","Blood: Lipid Panel, CoQ10 levels"
14. Vitamin B12(Methylcobalamin),Chronic(Daily),"Nervous System:restingHrBpm (Anemia causes rise), hrvMs","Cognitive: Subjective ""Brain Fog"", standHours(Fatigue proxy)","Blood: Serum B12, Homocysteine"
15. Collagen Peptides,Chronic (Long term 30d+),"Joint Stability:walkingSteadiness (iOS 15+), walkingAsymmetryPct","Activity: stepCount, walkingSpeed",Blood: None standard (Subjective skin/joint pain)
16. Zinc,Acute(Immune) or Chronic(Hormonal),"Immune Resilience:restingHrBpm (Spikes = fighting bug), respiratoryRate",Sleep: sleepEfficiency(Zinc aids sleep onset),"Blood: Plasma Zinc, Testosterone (Men)"
17. Lion's Mane(Mushroom),Chronic(Nootropic),"Focus/REM: remMinutes(Dream recall), mindfulMinutes (Focus proxy)","Stress: hrvMs, Subjective ""Clarity""","Blood: BDNF (Rarely tested), Cortisol"
18. Glucosamine / Chondroitin,Chronic (Very Slow 30-60d),"Mobility:walkingStepLength, doubleSupportPct (Limping indicator)","Volume:distanceWalkingRunning, flightsClimbed",Blood: HS-CRP
19. Vitamin C,Acute(Immune),"Stress Response: hrvMs(Acute stress resilience), restingHrBpm",Recovery:cardioRecovery,Blood: Serum Ascorbate
20. Beetroot / Nitrates,Acute(Performance),"Blood Flow: vo2Max, restingHrBpm (Vasodilation lowers BP/HR)","Work Capacity:activeEnergyKcal, appleExerciseTime",Blood: BP (Systolic/Diastolic)
3. Baseline & Data Logic,,,,
3.1 Baseline Calculation Rules,,,,
We will prioritize Retroactive Baselines to allow users to start immediately.,,,,
"Rule A: The ""New User"" (Retroactive)",,,,
"Condition: User selects current_status: ""New to me"".",,,,
Data Requirement: Check health_kit_ingest table for the last 30 days.,,,,
Validation:,,,,
Must have >14 days of sleep_nights data (if testing Sleep).,,,,
Must have >14 days of restingHrBpm (if testing Energy/Stress).,,,,
Action: Calculate MEAN and STD_DEV for all Primary Metrics in the Matrix. Set this as Phase_A_Baseline.,,,,
"Rule B: The ""Existing User"" (Washout)",,,,
"Condition: User selects current_status: ""Already taking"".",,,,
"Action: Enforce a 7-14 day ""Pause"" phase.",,,,
Data Requirement: New incoming data during this pause becomes the Phase_A_Baseline.,,,,
"3.2 Contextual ""Noise"" Filters",,,,
"To ensure the experiment is valid, we must flag ""noisy"" days where data should be excluded from the N-of-1 calculation.",,,,
Alcohol Filter: If nutrition_daily_metrics.alcohol (if you track it) or subjective input > 0.,,,,
"Activity Outlier: If activeEnergyKcal > (30-day Avg * 2.5) -> Flag as ""Extreme Exertion Day"" (Ignore sleep scores for that night as they will be physically impacted).",,,,
Sickness Indicator: If bodyTempC > 37.5 OR restingHrBpm > (Baseline + 15%).â€™,,,,
,,,,
,,,,
4. UI/UX Interface Requirements (JSON Structure),,,,
This JSON outlines exactly how the UI should behave during the setup wizard.,,,,
,,,,
{,,,,
"""module"": ""Experiment_Setup_Wizard"",",,,,
"""screens"": [",,,,
{,,,,
"""id"": ""scan_ingest"",",,,,
"""ui_component"": ""BarcodeCameraOverlay"",",,,,
"""instruction"": ""Scan the barcode of your supplement."",",,,,
"""api_call"": ""GET /api/product/{barcode}"",",,,,
"""on_success"": {",,,,
"""populate_fields"": [""product_name"", ""brand"", ""serving_size"", ""ingredients""],",,,,
"""trigger_logic"": ""Match ingredients to 'Configuration Matrix' to pre-select Metrics.""",,,,
},,,,
"},",,,,
{,,,,
"""id"": ""dosage_validation"",",,,,
"""ui_component"": ""FormInput"",",,,,
"""fields"": [",,,,
{,,,,
"""label"": ""Strength per pill"",",,,,
"""key"": ""strength_mg"",",,,,
"""default"": ""{api.strength}"",",,,,
"""editable"": true",,,,
"},",,,,
{,,,,
"""label"": ""How many do you take?"",",,,,
"""key"": ""quantity"",",,,,
"""default"": 1,",,,,
"""editable"": true",,,,
"},",,,,
{,,,,
"""label"": ""Calculated Daily Dose"",",,,,
"""type"": ""calculated_display"",",,,,
"""formula"": ""strength_mg * quantity"",",,,,
"""unit"": ""mg""",,,,
},,,,
],,,,
"},",,,,
{,,,,
"""id"": ""intent_selection"",",,,,
"""ui_component"": ""CardSelection"",",,,,
"""instruction"": ""What is your main goal for taking {product_name}?"",",,,,
"""options"": [",,,,
{,,,,
"""label"": ""Deep Sleep & Recovery"",",,,,
"""value"": ""sleep_recovery"",",,,,
"""recommended_for"": [""Magnesium"", ""Ashwagandha"", ""Melatonin""],",,,,
"""linked_metrics"": [""deepMinutes"", ""sleepEfficiency"", ""hrvMs""]",,,,
"},",,,,
{,,,,
"""label"": ""Energy & Vitality"",",,,,
"""value"": ""energy_vitality"",",,,,
"""recommended_for"": [""B12"", ""Iron"", ""CoQ10""],",,,,
"""linked_metrics"": [""activeEnergyKcal"", ""vo2Max"", ""restingHrBpm""]",,,,
"},",,,,
{,,,,
"""label"": ""Stress & Anxiety"",",,,,
"""value"": ""stress_mood"",",,,,
"""recommended_for"": [""Ashwagandha"", ""L-Theanine"", ""CBD""],",,,,
"""linked_metrics"": [""hrvMs"", ""avgRespiratoryRate"", ""avgHrv""]",,,,
"},",,,,
{,,,,
"""label"": ""Physical Composition"",",,,,
"""value"": ""body_comp"",",,,,
"""recommended_for"": [""Creatine"", ""Protein"", ""Fiber""],",,,,
"""linked_metrics"": [""weightKg"", ""leanBodyMassKg"", ""waistCircumference""]",,,,
},,,,
],,,,
"},",,,,
{,,,,
"""id"": ""baseline_check"",",,,,
"""ui_component"": ""StatusCheck"",",,,,
"""instruction"": ""Analyzing your historical data..."",",,,,
"""logic"": ""Query HealthKit for last 30 days of {linked_metrics}."",",,,,
"""states"": {",,,,
"""success"": ""We found enough data! You can start immediately."",",,,,
"""failure"": ""We need 5 days of data to learn your body. Experiment will start in Calibration Mode.""",,,,
},,,,
},,,,
],,,,
},,,,
,,,,
,,,,
"This Product Requirements Document (PRD) is tailored for your Engineering and Design teams. It maps your specific data ingestion schemas (HealthKit, Sleep, Nutrition, Gait) to the configuration logic for 10 common supplements.",,,,
,,,,
PRD: N-of-1 Experiment Setup & Configuration,,,,
1. Overview,,,,
"Module: Experiment Configuration Engine Goal: To automatically configure the tracked metrics, baseline duration, and success criteria for an experiment based on the specific supplement identified. User Value: ""Zero-config"" setup. The user scans a bottle, and the app instantly knows that Magnesium requires tracking Deep Sleep, whereas Creatinerequires tracking Weight and Active Energy.",,,,
,,,,
2. The Configuration Matrix (10 Common Supplements),,,,
"This table defines the ""Smart Defaults"" your backend will apply. It uses the exact field names from your schema.",,,,
Supplement,Protocol Type,Primary Metrics (Success Indicators),Secondary Metrics (Safety/Correlations),Relevant Blood/CGM
1. Magnesium(Glycinate/Citrate),Acute/Daily(Fast acting),"Sleep Quality: deepMinutes, sleepEfficiency, totalMinutesAsleep","Recovery: avgHrv, avgRespiratoryRate",Blood: Serum Magnesium
2. Creatine Monohydrate,Chronic(Requires Loading),"Performance: activeEnergyKcal, leanBodyMassKg (if avail)","Hydration/Mass: weightKg(Expect increase), dietaryWater","Blood:Creatinine, BUN"
3. Ashwagandha,Chronic (2-4 weeks),"Stress Response: hrvMs, avgHrv(Night), restingHrBpm","Sleep: sleepEfficiency, wakeAt(Latency)","Blood: Cortisol, Thyroid Panel"
4. Melatonin,Acute(Immediate),"Onset Latency: (asleepAt - inBedAt), totalMinutesAsleep","Sleep Architecture:remMinutes, deepMinutes",N/A
5. Omega-3 (Fish Oil),Chronic(Long term),"Cardio Health: hrvMs, restingHrBpm","Vitals: systolicMmHg, diastolicMmHg","Blood: Omega-3 Index, HS-CRP"
6. Vitamin D3,Chronic (Very Slow),"Energy/Mood: activeEnergyKcal, sleepEfficiency","Activity: stepsNormalized, flightsClimbed",Blood: 25-OH Vitamin D
7. Caffeine (or Pre-workout),Acute (Event based),"Stimulation: hrvMs (Watch for drops), restingHrBpm (Watch for spikes)","Sleep Negative:sleepEfficiency, deepMinutes",N/A
8. Fiber / Psyllium,Chronic(Daily),Metabolic: bloodGlucoseMgDl (CGM - Look for stability),"Weight: weightKg, waistCircumference","Blood: HbA1c, Lipids"
9. Iron,Chronic(Slow),"Fatigue/Capacity: vo2Max, activeEnergyKcal","Vitals: restingHrBpm, walkingHrBpm","Blood: Ferritin, Hemoglobin"
10. L-Theanine,Acute (Fast),"Relaxation: hrvMs (Acute rise), avgRespiratoryRate",Focus (Subjective):Correlate w/ exerciseMinutes,N/A
Export to Sheets,,,,
,,,,
3. Baseline & Data Logic,,,,
3.1 Baseline Calculation Rules,,,,
We will prioritize Retroactive Baselines to allow users to start immediately.,,,,
"Rule A: The ""New User"" (Retroactive)",,,,
"Condition: User selects current_status: ""New to me"".",,,,
Data Requirement: Check health_kit_ingest table for the last 30 days.,,,,
Validation:,,,,
Must have >14 days of sleep_nights data (if testing Sleep).,,,,
Must have >14 days of restingHrBpm (if testing Energy/Stress).,,,,
Action: Calculate MEAN and STD_DEV for all Primary Metrics in the Matrix. Set this as Phase_A_Baseline.,,,,
"Rule B: The ""Existing User"" (Washout)",,,,
"Condition: User selects current_status: ""Already taking"".",,,,
"Action: Enforce a 7-14 day ""Pause"" phase.",,,,
Data Requirement: New incoming data during this pause becomes the Phase_A_Baseline.,,,,
"3.2 Contextual ""Noise"" Filters",,,,
"To ensure the experiment is valid, we must flag ""noisy"" days where data should be excluded from the N-of-1 calculation.",,,,
Alcohol Filter: If nutrition_daily_metrics.alcohol (if you track it) or subjective input > 0.,,,,
"Activity Outlier: If activeEnergyKcal > (30-day Avg * 2.5) -> Flag as ""Extreme Exertion Day"" (Ignore sleep scores for that night as they will be physically impacted).",,,,
Sickness Indicator: If bodyTempC > 37.5 OR restingHrBpm > (Baseline + 15%).,,,,
,,,,
4. UI/UX Interface Requirements (JSON Structure),,,,
This JSON outlines exactly how the UI should behave during the setup wizard.,,,,
JSON,,,,
,,,,
{,,,,
"""module"": ""Experiment_Setup_Wizard"",",,,,
"""screens"": [",,,,
{,,,,
"""id"": ""scan_ingest"",",,,,
"""ui_component"": ""BarcodeCameraOverlay"",",,,,
"""instruction"": ""Scan the barcode of your supplement."",",,,,
"""api_call"": ""GET /api/product/{barcode}"",",,,,
"""on_success"": {",,,,
"""populate_fields"": [""product_name"", ""brand"", ""serving_size"", ""ingredients""],",,,,
"""trigger_logic"": ""Match ingredients to 'Configuration Matrix' to pre-select Metrics.""",,,,
},,,,
"},",,,,
{,,,,
"""id"": ""dosage_validation"",",,,,
"""ui_component"": ""FormInput"",",,,,
"""fields"": [",,,,
{,,,,
"""label"": ""Strength per pill"",",,,,
"""key"": ""strength_mg"",",,,,
"""default"": ""{api.strength}"",",,,,
"""editable"": true",,,,
"},",,,,
{,,,,
"""label"": ""How many do you take?"",",,,,
"""key"": ""quantity"",",,,,
"""default"": 1,",,,,
"""editable"": true",,,,
"},",,,,
{,,,,
"""label"": ""Calculated Daily Dose"",",,,,
"""type"": ""calculated_display"",",,,,
"""formula"": ""strength_mg * quantity"",",,,,
"""unit"": ""mg""",,,,
},,,,
],,,,
"},",,,,
{,,,,
"""id"": ""intent_selection"",",,,,
"""ui_component"": ""CardSelection"",",,,,
"""instruction"": ""What is your main goal for taking {product_name}?"",",,,,
"""options"": [",,,,
{,,,,
"""label"": ""Deep Sleep & Recovery"",",,,,
"""value"": ""sleep_recovery"",",,,,
"""recommended_for"": [""Magnesium"", ""Ashwagandha"", ""Melatonin""],",,,,
"""linked_metrics"": [""deepMinutes"", ""sleepEfficiency"", ""hrvMs""]",,,,
"},",,,,
{,,,,
"""label"": ""Energy & Vitality"",",,,,
"""value"": ""energy_vitality"",",,,,
"""recommended_for"": [""B12"", ""Iron"", ""CoQ10""],",,,,
"""linked_metrics"": [""activeEnergyKcal"", ""vo2Max"", ""restingHrBpm""]",,,,
"},",,,,
{,,,,
"""label"": ""Stress & Anxiety"",",,,,
"""value"": ""stress_mood"",",,,,
"""recommended_for"": [""Ashwagandha"", ""L-Theanine"", ""CBD""],",,,,
"""linked_metrics"": [""hrvMs"", ""avgRespiratoryRate"", ""avgHrv""]",,,,
"},",,,,
{,,,,
"""label"": ""Physical Composition"",",,,,
"""value"": ""body_comp"",",,,,
"""recommended_for"": [""Creatine"", ""Protein"", ""Fiber""],",,,,
"""linked_metrics"": [""weightKg"", ""leanBodyMassKg"", ""waistCircumference""]",,,,
},,,,
],,,,
"},",,,,
{,,,,
"""id"": ""baseline_check"",",,,,
"""ui_component"": ""StatusCheck"",",,,,
"""instruction"": ""Analyzing your historical data..."",",,,,
"""logic"": ""Query HealthKit for last 30 days of {linked_metrics}."",",,,,
"""states"": {",,,,
"""success"": ""We found enough data! You can start immediately."",",,,,
"""failure"": ""We need 5 days of data to learn your body. Experiment will start in Calibration Mode.""",,,,
},,,,
},,,,
],,,,
},,,,
,,,,
"5. Success Criteria (The ""Value"" Engine)",,,,
"This is the algorithm that determines if the user sees a ""Success"" screen at the end of the experiment.",,,,
Formula: Effect Size = (Avg_Phase_B - Avg_Phase_A) / Std_Dev_Phase_A,,,,
Thresholds:,,,,
High Value (Success): Effect Size > 0.8 (Large statistical improvement).,,,,
"UI: ""ğŸ‰ Strong Evidence: Magnesium increased your Deep Sleep by 18%.""",,,,
Moderate Value: Effect Size between 0.2 and 0.8.,,,,
"UI: ""ğŸ‘ Possible Benefit: We see a trend in your HRV, but it's minor.""",,,,
No Value (Save Money): Effect Size < 0.2.,,,,
"UI: ""ğŸ’¸ Save your money: This supplement made no measurable difference to your biometrics.""",,,,
6. Next Steps for Engineering,,,,
"Ingest: Connect the barcode_lookup_api or dsld_db to the ""Scan"" screen.",,,,
Map: Create a ExperimentConfig database table that stores the specific HKQuantityTypeIdentifiers selected for each user's active experiment.,,,,
"â€¢  3. Visuals: Design the ""Result Card"" that compares Phase A vs Phase B using the metrics defined in Section 2.",,,,