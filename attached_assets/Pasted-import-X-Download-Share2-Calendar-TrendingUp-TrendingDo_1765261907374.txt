import { X, Download, Share2, Calendar, TrendingUp, TrendingDown, AlertTriangle, CheckCircle, Minus, FileText, User, Activity } from 'lucide-react';

interface HealthReportScreenProps {
  isDark: boolean;
  onClose: () => void;
}

// Mock patient data
const patientData = {
  name: "Sarah Mitchell",
  age: 34,
  sex: "Female",
  dateOfBirth: "June 15, 1990",
  reportDate: "November 24, 2024",
  reportPeriod: "12-month analysis: November 2023 - November 2024",
  totalBiomarkers: 47,
  outOfRange: 5,
  requiresAttention: 2
};

// Critical alerts
const criticalAlerts = [
  {
    marker: "Vitamin D",
    currentValue: 28,
    unit: "ng/mL",
    standardRange: "30-100",
    optimalRange: "40-60",
    trend: "declining",
    severity: "moderate",
    lastTested: "Nov 15, 2024",
    note: "Below optimal range for 6 months. Correlates with reported fatigue and seasonal timing."
  },
  {
    marker: "Fasting Glucose",
    currentValue: 98,
    unit: "mg/dL",
    standardRange: "70-99",
    optimalRange: "70-85",
    trend: "increasing",
    severity: "moderate",
    lastTested: "Nov 10, 2024",
    note: "Upper normal range. Post-meal readings spike to 140+ mg/dL, suggesting early insulin sensitivity concerns."
  }
];

// Biomarker categories with trends
const biomarkerCategories = [
  {
    category: "Metabolic Health",
    status: "attention",
    markers: [
      { name: "Fasting Glucose", value: 98, unit: "mg/dL", status: "attention", trend: "up", change: "+8%" },
      { name: "HbA1c", value: 5.4, unit: "%", status: "optimal", trend: "stable", change: "0%" },
      { name: "Insulin", value: 8.2, unit: "μIU/mL", status: "optimal", trend: "stable", change: "+2%" },
      { name: "Triglycerides", value: 95, unit: "mg/dL", status: "optimal", trend: "down", change: "-12%" }
    ]
  },
  {
    category: "Cardiovascular",
    status: "good",
    markers: [
      { name: "Total Cholesterol", value: 185, unit: "mg/dL", status: "optimal", trend: "stable", change: "-3%" },
      { name: "LDL-C", value: 98, unit: "mg/dL", status: "optimal", trend: "down", change: "-8%" },
      { name: "HDL-C", value: 42, unit: "mg/dL", status: "attention", trend: "stable", change: "0%" },
      { name: "ApoB", value: 78, unit: "mg/dL", status: "optimal", trend: "down", change: "-5%" }
    ]
  },
  {
    category: "Vitamins & Minerals",
    status: "attention",
    markers: [
      { name: "Vitamin D", value: 28, unit: "ng/mL", status: "low", trend: "down", change: "-22%" },
      { name: "Vitamin B12", value: 450, unit: "pg/mL", status: "optimal", trend: "stable", change: "+3%" },
      { name: "Folate", value: 18, unit: "ng/mL", status: "optimal", trend: "stable", change: "0%" },
      { name: "Magnesium", value: 2.1, unit: "mg/dL", status: "optimal", trend: "stable", change: "+5%" }
    ]
  },
  {
    category: "Hormones",
    status: "good",
    markers: [
      { name: "TSH", value: 2.1, unit: "mIU/L", status: "optimal", trend: "stable", change: "0%" },
      { name: "Free T3", value: 3.2, unit: "pg/mL", status: "optimal", trend: "stable", change: "+2%" },
      { name: "Free T4", value: 1.3, unit: "ng/dL", status: "optimal", trend: "stable", change: "0%" },
      { name: "Cortisol", value: 14, unit: "μg/dL", status: "optimal", trend: "stable", change: "-8%" }
    ]
  },
  {
    category: "Inflammation & Immune",
    status: "good",
    markers: [
      { name: "hsCRP", value: 0.8, unit: "mg/L", status: "optimal", trend: "down", change: "-20%" },
      { name: "Homocysteine", value: 8.5, unit: "μmol/L", status: "optimal", trend: "stable", change: "0%" },
      { name: "WBC", value: 6.2, unit: "K/μL", status: "optimal", trend: "stable", change: "+3%" }
    ]
  },
  {
    category: "Liver Function",
    status: "attention",
    markers: [
      { name: "ALT", value: 38, unit: "U/L", status: "attention", trend: "up", change: "+15%" },
      { name: "AST", value: 32, unit: "U/L", status: "attention", trend: "up", change: "+10%" },
      { name: "GGT", value: 22, unit: "U/L", status: "optimal", trend: "stable", change: "0%" }
    ]
  }
];

// AI Correlation Insights
const correlationInsights = [
  {
    title: "Vitamin D Deficiency → Sleep Quality Impact",
    description: "Declining Vitamin D levels (22% decrease over 6 months) correlate with reported sleep onset variability and reduced HRV recovery scores.",
    biomarkersInvolved: ["Vitamin D", "HRV", "Sleep Quality"],
    clinicalRelevance: "Vitamin D receptors are present in brain regions involved in sleep regulation. Supplementation may improve sleep consistency."
  },
  {
    title: "Post-Prandial Glucose Spikes → Insulin Sensitivity",
    description: "Fasting glucose trending upward (+8%) with post-meal spikes to 140+ mg/dL despite normal HbA1c. Early insulin resistance pattern.",
    biomarkersInvolved: ["Fasting Glucose", "Post-Meal Glucose", "Insulin"],
    clinicalRelevance: "Lifestyle intervention window: Diet sequencing and Zone 2 cardio can reverse early metabolic dysfunction before HbA1c elevation."
  },
  {
    title: "Low HDL → Cardiovascular Exercise Gap",
    description: "HDL-C remains at 42 mg/dL (below optimal) despite improved LDL. Patient reports <2 hours weekly Zone 2 aerobic exercise.",
    biomarkersInvolved: ["HDL-C", "ApoB", "Resting Heart Rate"],
    clinicalRelevance: "HDL responds specifically to sustained aerobic exercise. Target: 3x45min weekly Zone 2 cardio for HDL optimization."
  },
  {
    title: "Elevated Liver Enzymes → Lifestyle Factors",
    description: "ALT +15% and AST +10% over 6 months. Patient reports 4-6 alcoholic drinks weekly and limited cruciferous vegetable intake.",
    biomarkersInvolved: ["ALT", "AST", "GGT"],
    clinicalRelevance: "Mild hepatic stress. Recommend alcohol reduction (≤2 weekly), increase cruciferous vegetables, adequate hydration. Retest in 6 months."
  }
];

// Retest recommendations
const retestRecommendations = [
  { marker: "Vitamin D", priority: "High", interval: "3 months", rationale: "Below optimal range, active intervention underway" },
  { marker: "Fasting Glucose", priority: "High", interval: "3 months", rationale: "Trending upward, insulin sensitivity concerns" },
  { marker: "Liver Panel (ALT/AST)", priority: "Moderate", interval: "6 months", rationale: "Elevated enzymes, lifestyle modifications initiated" },
  { marker: "HDL-C", priority: "Moderate", interval: "3 months", rationale: "Below optimal, exercise intervention started" },
  { marker: "Lipid Panel", priority: "Low", interval: "12 months", rationale: "Stable and optimal, routine monitoring" },
  { marker: "Thyroid Panel", priority: "Low", interval: "12 months", rationale: "Stable and optimal, routine monitoring" }
];

// Active interventions
const activeInterventions = [
  {
    title: "Optimize Vitamin D Levels",
    started: "Nov 1, 2024",
    target: "50 ng/mL",
    actions: ["Vitamin D3 4,000 IU daily", "15-20 min daily sun exposure"],
    progress: "In progress - 23 days"
  },
  {
    title: "Reduce Post-Meal Glucose Spikes",
    started: "Oct 28, 2024",
    target: "85 mg/dL fasting",
    actions: ["Protein/veg before carbs", "10-min post-meal walks"],
    progress: "In progress - 27 days"
  },
  {
    title: "Increase Weekly Zone 2 Training",
    started: "Nov 15, 2024",
    target: "60 mg/dL HDL",
    actions: ["3x 45-min Zone 2 cardio weekly", "HR 130-145 bpm"],
    progress: "In progress - 9 days"
  }
];

export function HealthReportScreen({ isDark, onClose }: HealthReportScreenProps) {
  const handlePrint = () => {
    window.print();
  };

  const handleDownloadPDF = () => {
    window.print(); // Browser's print-to-PDF
  };

  const handleShare = () => {
    // Share functionality
    alert('Share functionality would generate a secure, expiring link');
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'low':
      case 'critical':
        return isDark ? 'text-red-400 bg-red-500/10 border-red-500/30' : 'text-red-700 bg-red-50 border-red-200';
      case 'attention':
        return isDark ? 'text-amber-400 bg-amber-500/10 border-amber-500/30' : 'text-amber-700 bg-amber-50 border-amber-200';
      case 'optimal':
      case 'good':
        return isDark ? 'text-teal-400 bg-teal-500/10 border-teal-500/30' : 'text-teal-700 bg-teal-50 border-teal-200';
      default:
        return isDark ? 'text-gray-400 bg-gray-500/10 border-gray-500/30' : 'text-gray-700 bg-gray-50 border-gray-200';
    }
  };

  const getTrendIcon = (trend: string) => {
    switch (trend) {
      case 'up':
      case 'increasing':
        return <TrendingUp className="w-4 h-4 text-red-400" />;
      case 'down':
      case 'declining':
        return <TrendingDown className="w-4 h-4 text-teal-400" />;
      default:
        return <Minus className="w-4 h-4 text-gray-400" />;
    }
  };

  return (
    <div className={`fixed inset-0 z-50 ${isDark ? 'bg-slate-900' : 'bg-gray-50'}`}>
      {/* Header - Hidden in print */}
      <header className={`sticky top-0 z-10 backdrop-blur-xl border-b transition-colors print:hidden ${
        isDark ? 'bg-slate-900/95 border-white/10' : 'bg-white/95 border-gray-200'
      }`}>
        <div className="px-4 py-3">
          <div className="flex items-center justify-between">
            <div>
              <h1 className={`text-xl font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>
                Health Summary Report
              </h1>
              <p className={`text-xs ${isDark ? 'text-white/50' : 'text-gray-500'}`}>
                {patientData.reportPeriod}
              </p>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={handleShare}
                className={`p-2 rounded-lg transition-colors ${
                  isDark ? 'hover:bg-white/10' : 'hover:bg-gray-100'
                }`}
                title="Share Report"
              >
                <Share2 className={`w-5 h-5 ${isDark ? 'text-white/70' : 'text-gray-600'}`} />
              </button>
              <button
                onClick={handleDownloadPDF}
                className={`p-2 rounded-lg transition-colors ${
                  isDark ? 'hover:bg-white/10' : 'hover:bg-gray-100'
                }`}
                title="Download PDF"
              >
                <Download className={`w-5 h-5 ${isDark ? 'text-white/70' : 'text-gray-600'}`} />
              </button>
              <button
                onClick={onClose}
                className={`p-2 rounded-lg transition-colors ${
                  isDark ? 'hover:bg-white/10' : 'hover:bg-gray-100'
                }`}
              >
                <X className={`w-5 h-5 ${isDark ? 'text-white/70' : 'text-gray-600'}`} />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Report Content */}
      <main className="overflow-y-auto" style={{ height: 'calc(100vh - 65px)' }}>
        <div className="max-w-4xl mx-auto p-6 print:p-0">
          
          {/* Print Header - Only visible when printing */}
          <div className="hidden print:block mb-8 pb-4 border-b-2 border-gray-300">
            <div className="flex items-start justify-between mb-4">
              <div>
                <h1 className="text-2xl font-bold text-gray-900 mb-1">Flō Health Summary Report</h1>
                <p className="text-sm text-gray-600">Longitudinal Biomarker Analysis</p>
              </div>
              <div className="text-right text-sm text-gray-600">
                <div>Report Date: {patientData.reportDate}</div>
                <div>Analysis Period: 12 months</div>
              </div>
            </div>
          </div>

          {/* Executive Summary */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none print:shadow-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <User className={`w-5 h-5 ${isDark ? 'text-teal-400' : 'text-teal-600'}`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                Executive Summary
              </h2>
            </div>

            <div className="grid grid-cols-2 gap-6 mb-6">
              <div>
                <div className={`text-xs uppercase tracking-wider mb-2 ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-600`}>
                  Patient Information
                </div>
                <div className={`space-y-1 ${isDark ? 'text-white/80' : 'text-gray-700'} print:text-gray-900`}>
                  <div className="flex justify-between">
                    <span className="text-sm">Name:</span>
                    <span className="text-sm font-medium">{patientData.name}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-sm">Date of Birth:</span>
                    <span className="text-sm font-medium">{patientData.dateOfBirth}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-sm">Age:</span>
                    <span className="text-sm font-medium">{patientData.age} years</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-sm">Sex:</span>
                    <span className="text-sm font-medium">{patientData.sex}</span>
                  </div>
                </div>
              </div>

              <div>
                <div className={`text-xs uppercase tracking-wider mb-2 ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-600`}>
                  Report Summary
                </div>
                <div className="grid grid-cols-3 gap-3">
                  <div className={`p-3 rounded-lg border print:border-gray-300 ${isDark ? 'bg-teal-500/10 border-teal-500/30' : 'bg-teal-50 border-teal-200'}`}>
                    <div className={`text-2xl font-bold mb-1 ${isDark ? 'text-teal-400' : 'text-teal-700'} print:text-teal-700`}>
                      {patientData.totalBiomarkers}
                    </div>
                    <div className={`text-xs ${isDark ? 'text-teal-300' : 'text-teal-600'} print:text-teal-700`}>
                      Biomarkers
                    </div>
                  </div>
                  <div className={`p-3 rounded-lg border print:border-gray-300 ${isDark ? 'bg-amber-500/10 border-amber-500/30' : 'bg-amber-50 border-amber-200'}`}>
                    <div className={`text-2xl font-bold mb-1 ${isDark ? 'text-amber-400' : 'text-amber-700'} print:text-amber-700`}>
                      {patientData.outOfRange}
                    </div>
                    <div className={`text-xs ${isDark ? 'text-amber-300' : 'text-amber-600'} print:text-amber-700`}>
                      Suboptimal
                    </div>
                  </div>
                  <div className={`p-3 rounded-lg border print:border-gray-300 ${isDark ? 'bg-red-500/10 border-red-500/30' : 'bg-red-50 border-red-200'}`}>
                    <div className={`text-2xl font-bold mb-1 ${isDark ? 'text-red-400' : 'text-red-700'} print:text-red-700`}>
                      {patientData.requiresAttention}
                    </div>
                    <div className={`text-xs ${isDark ? 'text-red-300' : 'text-red-600'} print:text-red-700`}>
                      Attention
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div className={`p-4 rounded-lg border print:border-gray-300 ${isDark ? 'bg-blue-500/5 border-blue-500/20' : 'bg-blue-50 border-blue-200'}`}>
              <p className={`text-sm ${isDark ? 'text-blue-200' : 'text-blue-900'} print:text-blue-900`}>
                <strong>Overall Assessment:</strong> Patient demonstrates good metabolic awareness with active health optimization. 
                Primary areas for intervention: Vitamin D supplementation, glucose management through dietary sequencing, 
                and cardiovascular exercise for HDL optimization. Liver enzymes warrant monitoring with lifestyle modifications.
              </p>
            </div>
          </section>

          {/* Critical Alerts */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <AlertTriangle className={`w-5 h-5 ${isDark ? 'text-amber-400' : 'text-amber-600'} print:text-amber-600`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                Priority Biomarkers Requiring Attention
              </h2>
            </div>

            <div className="space-y-4">
              {criticalAlerts.map((alert, index) => (
                <div key={index} className={`p-4 rounded-lg border print:border-gray-300 ${
                  isDark ? 'bg-amber-500/5 border-amber-500/20' : 'bg-amber-50 border-amber-200'
                }`}>
                  <div className="flex items-start justify-between mb-2">
                    <div>
                      <h3 className={`font-medium mb-1 ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                        {alert.marker}
                      </h3>
                      <div className="flex items-center gap-3 text-sm">
                        <span className={isDark ? 'text-white/70' : 'text-gray-600'}>
                          Current: <strong>{alert.currentValue} {alert.unit}</strong>
                        </span>
                        <span className={isDark ? 'text-white/50' : 'text-gray-500'}>|</span>
                        <span className={isDark ? 'text-white/70' : 'text-gray-600'}>
                          Optimal: {alert.optimalRange} {alert.unit}
                        </span>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      {getTrendIcon(alert.trend)}
                      <span className={`text-xs px-2 py-1 rounded ${
                        alert.severity === 'moderate' 
                          ? 'bg-amber-500/20 text-amber-300 print:bg-amber-200 print:text-amber-900' 
                          : 'bg-red-500/20 text-red-300 print:bg-red-200 print:text-red-900'
                      }`}>
                        {alert.severity}
                      </span>
                    </div>
                  </div>
                  <p className={`text-sm ${isDark ? 'text-white/60' : 'text-gray-600'} print:text-gray-700`}>
                    {alert.note}
                  </p>
                  <div className={`mt-2 text-xs ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-600`}>
                    Last tested: {alert.lastTested}
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Biomarker Trends by Category */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <Activity className={`w-5 h-5 ${isDark ? 'text-teal-400' : 'text-teal-600'} print:text-teal-600`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                Biomarker Trends by Category
              </h2>
            </div>

            <div className="space-y-6">
              {biomarkerCategories.map((category, idx) => (
                <div key={idx} className="print:break-inside-avoid">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                      {category.category}
                    </h3>
                    <span className={`text-xs px-2.5 py-1 rounded-full border ${getStatusColor(category.status)} print:border-gray-400`}>
                      {category.status === 'good' ? 'Good' : category.status === 'attention' ? 'Needs Attention' : 'Optimal'}
                    </span>
                  </div>
                  
                  <div className={`rounded-lg border overflow-hidden print:border-gray-300 ${isDark ? 'border-white/10' : 'border-gray-200'}`}>
                    <table className="w-full text-sm">
                      <thead className={isDark ? 'bg-white/5' : 'bg-gray-50 print:bg-gray-100'}>
                        <tr>
                          <th className={`text-left p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Biomarker</th>
                          <th className={`text-right p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Current Value</th>
                          <th className={`text-center p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Trend</th>
                          <th className={`text-right p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>12-mo Change</th>
                          <th className={`text-center p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {category.markers.map((marker, mIdx) => (
                          <tr key={mIdx} className={`border-t ${isDark ? 'border-white/10' : 'border-gray-200 print:border-gray-300'}`}>
                            <td className={`p-3 ${isDark ? 'text-white/80' : 'text-gray-900'}`}>{marker.name}</td>
                            <td className={`p-3 text-right ${isDark ? 'text-white/80' : 'text-gray-900'}`}>
                              {marker.value} {marker.unit}
                            </td>
                            <td className="p-3 text-center">
                              {getTrendIcon(marker.trend)}
                            </td>
                            <td className={`p-3 text-right ${isDark ? 'text-white/70' : 'text-gray-600'}`}>
                              {marker.change}
                            </td>
                            <td className="p-3 text-center">
                              <span className={`inline-block w-3 h-3 rounded-full ${
                                marker.status === 'optimal' ? 'bg-teal-500' : 
                                marker.status === 'attention' ? 'bg-amber-500' : 
                                'bg-red-500'
                              }`} />
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* AI Correlation Insights */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none print:break-before-page ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <TrendingUp className={`w-5 h-5 ${isDark ? 'text-purple-400' : 'text-purple-600'} print:text-purple-600`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                AI-Powered Correlation Insights
              </h2>
            </div>
            <p className={`text-sm mb-4 ${isDark ? 'text-white/60' : 'text-gray-600'} print:text-gray-700`}>
              Multi-biomarker pattern analysis identifying clinically relevant relationships and intervention opportunities.
            </p>

            <div className="space-y-4">
              {correlationInsights.map((insight, index) => (
                <div key={index} className={`p-4 rounded-lg border print:border-gray-300 print:break-inside-avoid ${
                  isDark ? 'bg-purple-500/5 border-purple-500/20' : 'bg-purple-50 border-purple-200'
                }`}>
                  <h3 className={`font-medium mb-2 ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                    {insight.title}
                  </h3>
                  <p className={`text-sm mb-3 ${isDark ? 'text-white/70' : 'text-gray-700'} print:text-gray-800`}>
                    {insight.description}
                  </p>
                  <div className="flex flex-wrap gap-2 mb-3">
                    {insight.biomarkersInvolved.map((marker, mIdx) => (
                      <span key={mIdx} className={`text-xs px-2 py-1 rounded ${
                        isDark ? 'bg-white/10 text-white/70' : 'bg-white text-gray-700 border border-gray-300'
                      }`}>
                        {marker}
                      </span>
                    ))}
                  </div>
                  <div className={`text-sm p-3 rounded border-l-4 ${
                    isDark 
                      ? 'bg-purple-500/10 border-purple-500 text-purple-200' 
                      : 'bg-purple-100 border-purple-500 text-purple-900'
                  } print:bg-purple-100 print:text-purple-900 print:border-purple-500`}>
                    <strong>Clinical Relevance:</strong> {insight.clinicalRelevance}
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Active Interventions */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <CheckCircle className={`w-5 h-5 ${isDark ? 'text-teal-400' : 'text-teal-600'} print:text-teal-600`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                Active Patient Interventions
              </h2>
            </div>
            <p className={`text-sm mb-4 ${isDark ? 'text-white/60' : 'text-gray-600'} print:text-gray-700`}>
              Patient is actively engaged in health optimization with the following tracked interventions:
            </p>

            <div className="space-y-3">
              {activeInterventions.map((intervention, index) => (
                <div key={index} className={`p-4 rounded-lg border print:border-gray-300 ${
                  isDark ? 'bg-teal-500/5 border-teal-500/20' : 'bg-teal-50 border-teal-200'
                }`}>
                  <div className="flex items-start justify-between mb-2">
                    <h3 className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                      {intervention.title}
                    </h3>
                    <span className={`text-xs ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-700`}>
                      Started {intervention.started}
                    </span>
                  </div>
                  <div className={`text-sm mb-2 ${isDark ? 'text-white/70' : 'text-gray-700'}`}>
                    <strong>Target:</strong> {intervention.target}
                  </div>
                  <ul className={`text-sm space-y-1 mb-2 ${isDark ? 'text-white/60' : 'text-gray-600'} print:text-gray-700`}>
                    {intervention.actions.map((action, aIdx) => (
                      <li key={aIdx} className="flex items-start gap-2">
                        <span className={isDark ? 'text-teal-400' : 'text-teal-600'}>•</span>
                        {action}
                      </li>
                    ))}
                  </ul>
                  <div className={`text-xs ${isDark ? 'text-teal-300' : 'text-teal-700'}`}>
                    {intervention.progress}
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Retest Recommendations */}
          <section className={`rounded-2xl border p-6 mb-6 print:border-gray-300 print:rounded-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-4">
              <Calendar className={`w-5 h-5 ${isDark ? 'text-blue-400' : 'text-blue-600'} print:text-blue-600`} />
              <h2 className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'} print:text-gray-900`}>
                Recommended Retest Schedule
              </h2>
            </div>

            <div className={`rounded-lg border overflow-hidden print:border-gray-300 ${isDark ? 'border-white/10' : 'border-gray-200'}`}>
              <table className="w-full text-sm">
                <thead className={isDark ? 'bg-white/5' : 'bg-gray-50 print:bg-gray-100'}>
                  <tr>
                    <th className={`text-left p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Biomarker</th>
                    <th className={`text-center p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Priority</th>
                    <th className={`text-center p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Retest In</th>
                    <th className={`text-left p-3 ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>Rationale</th>
                  </tr>
                </thead>
                <tbody>
                  {retestRecommendations.map((retest, index) => (
                    <tr key={index} className={`border-t ${isDark ? 'border-white/10' : 'border-gray-200 print:border-gray-300'}`}>
                      <td className={`p-3 ${isDark ? 'text-white/80' : 'text-gray-900'}`}>{retest.marker}</td>
                      <td className="p-3 text-center">
                        <span className={`text-xs px-2 py-1 rounded ${
                          retest.priority === 'High' 
                            ? 'bg-red-500/20 text-red-400 print:bg-red-200 print:text-red-900' 
                            : retest.priority === 'Moderate'
                            ? 'bg-amber-500/20 text-amber-400 print:bg-amber-200 print:text-amber-900'
                            : 'bg-teal-500/20 text-teal-400 print:bg-teal-200 print:text-teal-900'
                        }`}>
                          {retest.priority}
                        </span>
                      </td>
                      <td className={`p-3 text-center ${isDark ? 'text-white/80' : 'text-gray-900'}`}>
                        {retest.interval}
                      </td>
                      <td className={`p-3 ${isDark ? 'text-white/60' : 'text-gray-600'} print:text-gray-700`}>
                        {retest.rationale}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </section>

          {/* Footer / Disclaimers */}
          <section className={`rounded-2xl border p-6 print:border-gray-300 print:rounded-none ${
            isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'
          }`}>
            <div className="flex items-center gap-2 mb-3">
              <FileText className={`w-4 h-4 ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-600`} />
              <h3 className={`text-sm font-medium ${isDark ? 'text-white/70' : 'text-gray-600'} print:text-gray-900`}>
                Report Information
              </h3>
            </div>
            <div className={`text-xs space-y-2 ${isDark ? 'text-white/50' : 'text-gray-500'} print:text-gray-700`}>
              <p>
                <strong>Data Source:</strong> This report aggregates laboratory results from certified clinical laboratories. 
                Test methodologies and reference ranges are laboratory-specific and indicated on original lab reports.
              </p>
              <p>
                <strong>AI Insights:</strong> Correlation analysis is generated using Flō's proprietary AI health correlation engine. 
                Insights are based on peer-reviewed longevity research and should be considered alongside clinical judgment.
              </p>
              <p>
                <strong>Optimal Ranges:</strong> Flō uses longevity-optimized reference ranges that may differ from standard laboratory 
                ranges. These are based on current longevity research and represent targets associated with healthspan optimization.
              </p>
              <p>
                <strong>Disclaimer:</strong> This report is for informational purposes only and does not constitute medical advice, 
                diagnosis, or treatment. All medical decisions should be made in consultation with qualified healthcare providers. 
                Flō is not intended for diagnostic purposes or emergency medical situations.
              </p>
              <p className="pt-2 border-t border-current">
                <strong>Generated:</strong> {patientData.reportDate} | <strong>Flō by Nuvitae Health</strong> | www.get-flo.com
              </p>
            </div>
          </section>

        </div>
      </main>

      {/* Print-specific styles */}
      <style>{`
        @media print {
          @page {
            margin: 0.75in;
            size: letter;
          }
          
          body {
            background: white !important;
            color: black !important;
          }
          
          .print\\:hidden {
            display: none !important;
          }
          
          .print\\:block {
            display: block !important;
          }
          
          .print\\:break-before-page {
            break-before: page;
          }
          
          .print\\:break-inside-avoid {
            break-inside: avoid;
          }
          
          .print\\:border-gray-300 {
            border-color: #d1d5db !important;
          }
          
          .print\\:text-gray-900 {
            color: #111827 !important;
          }
          
          .print\\:text-gray-700 {
            color: #374151 !important;
          }
          
          .print\\:text-gray-600 {
            color: #4b5563 !important;
          }
          
          .print\\:bg-gray-100 {
            background-color: #f3f4f6 !important;
          }
          
          .print\\:rounded-none {
            border-radius: 0 !important;
          }
          
          .print\\:shadow-none {
            box-shadow: none !important;
          }
          
          /* Force visibility of print-only elements */
          .hidden.print\\:block {
            display: block !important;
          }
          
          /* Ensure tables don't break poorly */
          table {
            break-inside: avoid;
          }
          
          tr {
            break-inside: avoid;
          }
        }
      `}</style>
    </div>
  );
}