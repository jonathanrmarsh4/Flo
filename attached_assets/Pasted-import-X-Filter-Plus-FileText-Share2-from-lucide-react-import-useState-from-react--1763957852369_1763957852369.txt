import { X, Filter, Plus, FileText, Share2 } from 'lucide-react';
import { useState } from 'react';
import { ActionCard, ActionItem } from './ActionCard';

interface ActionsScreenProps {
  isDark: boolean;
  onClose: () => void;
  onOpenReport: () => void;
}

// Mock action plan data - in production, this would come from user's selected insights
const mockActions: ActionItem[] = [
  {
    id: '1',
    title: 'Optimize Vitamin D Levels',
    insight: 'Your Vitamin D levels have been trending below optimal range for the past 6 months, correlating with decreased energy and sleep quality.',
    recommendedAction: 'Increase daily Vitamin D3 supplementation to 4,000 IU and aim for 15-20 minutes of direct sunlight exposure daily. Retest in 3 months.',
    category: 'Biomarkers',
    addedDate: '2024-11-01',
    targetBiomarker: 'Vitamin D',
    currentValue: 28,
    targetValue: 50,
    unit: 'ng/mL'
  },
  {
    id: '2',
    title: 'Improve Sleep Consistency',
    insight: 'Your sleep onset time varies by more than 90 minutes across the week, impacting your HRV recovery and morning glucose levels.',
    recommendedAction: 'Establish a consistent bedtime routine. Aim to sleep between 10:00-10:30 PM every night, including weekends. Track progress with HRV trends.',
    category: 'Sleep',
    addedDate: '2024-11-10',
    targetBiomarker: 'HRV',
    currentValue: 52,
    targetValue: 68,
    unit: 'ms'
  },
  {
    id: '3',
    title: 'Reduce Post-Meal Glucose Spikes',
    insight: 'Your post-meal glucose levels spike above 140 mg/dL after high-carb meals, indicating insulin sensitivity concerns.',
    recommendedAction: 'Start meals with protein and vegetables before carbohydrates. Add a 10-minute walk after lunch and dinner. Monitor fasting glucose weekly.',
    category: 'Biomarkers',
    addedDate: '2024-10-28',
    targetBiomarker: 'Fasting Glucose',
    currentValue: 98,
    targetValue: 85,
    unit: 'mg/dL'
  },
  {
    id: '4',
    title: 'Increase Weekly Zone 2 Training',
    insight: 'Your cardiovascular biomarkers suggest insufficient aerobic base development. HDL could improve with consistent Zone 2 cardio.',
    recommendedAction: 'Add 3 sessions of 45-minute Zone 2 cardio per week (heart rate 130-145 bpm). Track resting heart rate and HDL levels quarterly.',
    category: 'Activity',
    addedDate: '2024-11-15',
    targetBiomarker: 'HDL',
    currentValue: 42,
    targetValue: 60,
    unit: 'mg/dL'
  },
  {
    id: '5',
    title: 'Support Liver Health',
    insight: 'Your ALT and AST levels are in the upper normal range, potentially indicating mild liver stress from diet or supplements.',
    recommendedAction: 'Reduce alcohol to â‰¤2 drinks per week, increase cruciferous vegetables, and ensure adequate hydration (3L daily). Retest liver panel in 6 months.',
    category: 'Recovery',
    addedDate: '2024-11-05',
    targetBiomarker: 'ALT',
    currentValue: 38,
    targetValue: 25,
    unit: 'U/L'
  }
];

export function ActionsScreen({ isDark, onClose, onOpenReport }: ActionsScreenProps) {
  const [selectedFilter, setSelectedFilter] = useState<string>('All');
  const categories = ['All', 'Sleep', 'Activity', 'Biomarkers', 'Recovery', 'Nutrition'];

  const filteredActions = selectedFilter === 'All' 
    ? mockActions 
    : mockActions.filter(action => action.category === selectedFilter);

  return (
    <div 
      className={`fixed inset-0 z-50 ${
        isDark 
          ? 'bg-gradient-to-br from-slate-900 via-blue-950 to-slate-900' 
          : 'bg-gradient-to-br from-blue-50 via-teal-50 to-cyan-50'
      }`}
    >
      {/* Header */}
      <header className={`sticky top-0 z-10 backdrop-blur-xl border-b transition-colors ${
        isDark ? 'bg-white/5 border-white/10' : 'bg-white/70 border-black/10'
      }`}>
        <div className="px-4 py-3">
          <div className="flex items-center justify-between">
            <div>
              <h1 className={`text-xl font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>
                Action Plan
              </h1>
              <p className={`text-xs ${isDark ? 'text-white/50' : 'text-gray-500'}`}>
                {filteredActions.length} active {filteredActions.length === 1 ? 'action' : 'actions'}
              </p>
            </div>
            <div className="flex items-center gap-2">
              <button
                className={`p-2 rounded-lg transition-all ${
                  isDark 
                    ? 'bg-gradient-to-r from-teal-500 via-cyan-500 to-blue-500 text-white shadow-lg shadow-cyan-500/25' 
                    : 'bg-gradient-to-r from-teal-400 via-cyan-400 to-blue-400 text-white shadow-lg'
                }`}
              >
                <Plus className="w-5 h-5" />
              </button>
              <button 
                onClick={onClose}
                className={`p-2 rounded-lg transition-colors ${
                  isDark ? 'hover:bg-white/10' : 'hover:bg-black/5'
                }`}
              >
                <X className={`w-5 h-5 ${isDark ? 'text-white/70' : 'text-gray-600'}`} />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Filter Tabs */}
      <div className={`sticky top-[65px] z-10 backdrop-blur-xl border-b transition-colors ${
        isDark ? 'bg-white/5 border-white/10' : 'bg-white/70 border-black/10'
      }`}>
        <div className="px-3 py-2.5">
          <div className="flex items-center gap-2">
            <Filter className={`w-4 h-4 flex-shrink-0 ${isDark ? 'text-white/50' : 'text-gray-500'}`} />
            <div className="flex gap-1.5 overflow-x-auto scrollbar-hide">
              {categories.map(category => {
                const isActive = selectedFilter === category;
                return (
                  <button
                    key={category}
                    onClick={() => setSelectedFilter(category)}
                    className={`px-3 py-1.5 rounded-full whitespace-nowrap transition-all text-xs ${
                      isActive
                        ? 'bg-gradient-to-r from-teal-500 via-cyan-500 to-blue-500 text-white shadow-lg shadow-cyan-500/25'
                        : isDark
                          ? 'bg-white/10 text-white/70 hover:bg-white/20'
                          : 'bg-white/60 text-gray-700 hover:bg-white/80'
                    }`}
                  >
                    {category}
                  </button>
                );
              })}
            </div>
          </div>
        </div>
      </div>

      {/* Actions List */}
      <main className="px-4 py-4 pb-24 overflow-y-auto" style={{ height: 'calc(100vh - 130px)' }}>
        <div className="max-w-2xl mx-auto space-y-3">
          {/* Reports Tile */}
          <div
            style={{
              animation: 'slideUp 0.4s ease-out both'
            }}
          >
            <div 
              onClick={onOpenReport}
              className={`backdrop-blur-xl rounded-2xl border transition-all cursor-pointer hover:scale-[1.01] ${
                isDark ? 'bg-white/5 border-white/10 hover:shadow-xl' : 'bg-white/60 border-black/10 hover:shadow-lg'
              }`}
            >
              <div className="p-4">
                <div className="flex items-start gap-4">
                  {/* Icon */}
                  <div className="p-3 rounded-xl border bg-gradient-to-br from-purple-500/20 to-pink-500/20 border-purple-500/30">
                    <FileText className="w-6 h-6 text-purple-400" />
                  </div>
                  
                  {/* Content */}
                  <div className="flex-1">
                    <div className="flex items-start justify-between mb-2">
                      <div>
                        <h3 className={`font-medium mb-1 ${isDark ? 'text-white' : 'text-gray-900'}`}>
                          Health Summary Report
                        </h3>
                        <p className={`text-sm ${isDark ? 'text-white/60' : 'text-gray-600'}`}>
                          Comprehensive biomarker analysis ready to share
                        </p>
                      </div>
                    </div>
                    
                    {/* Quick Stats */}
                    <div className="flex items-center gap-4 mt-3">
                      <div className={`px-2.5 py-1 rounded-lg border ${
                        isDark ? 'bg-teal-500/10 border-teal-500/30' : 'bg-teal-50 border-teal-200'
                      }`}>
                        <div className="flex items-center gap-1.5">
                          <div className="w-2 h-2 rounded-full bg-teal-400"></div>
                          <span className={`text-xs ${isDark ? 'text-teal-300' : 'text-teal-700'}`}>
                            90+ Biomarkers
                          </span>
                        </div>
                      </div>
                      <div className={`px-2.5 py-1 rounded-lg border ${
                        isDark ? 'bg-purple-500/10 border-purple-500/30' : 'bg-purple-50 border-purple-200'
                      }`}>
                        <div className="flex items-center gap-1.5">
                          <Share2 className="w-3 h-3 text-purple-400" />
                          <span className={`text-xs ${isDark ? 'text-purple-300' : 'text-purple-700'}`}>
                            Shareable
                          </span>
                        </div>
                      </div>
                    </div>
                    
                    {/* View Button */}
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        onOpenReport();
                      }}
                      className={`w-full mt-3 py-2.5 rounded-xl font-medium transition-all ${
                        isDark 
                          ? 'bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500 text-white shadow-lg shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30' 
                          : 'bg-gradient-to-r from-purple-400 via-pink-400 to-rose-400 text-white shadow-lg hover:shadow-xl'
                      }`}
                    >
                      <div className="flex items-center justify-center gap-2">
                        <FileText className="w-4 h-4" />
                        <span className="text-sm">View Full Report</span>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {filteredActions.length === 0 ? (
            <div className="text-center py-12">
              <div className={`text-6xl mb-4 opacity-20`}>ðŸ“‹</div>
              <h3 className={`mb-2 ${isDark ? 'text-white' : 'text-gray-900'}`}>
                No actions in this category
              </h3>
              <p className={`text-sm ${isDark ? 'text-white/50' : 'text-gray-500'}`}>
                Try selecting a different filter
              </p>
            </div>
          ) : (
            filteredActions.map((action, index) => (
              <div
                key={action.id}
                style={{
                  animation: `slideUp 0.4s ease-out ${index * 0.05 + 0.05}s both`
                }}
              >
                <ActionCard action={action} isDark={isDark} />
              </div>
            ))
          )}
        </div>
      </main>

      <style>{`
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `}</style>
    </div>
  );
}
